# Исправления для BeiDou B1C сигнала

## Обнаруженные и исправленные проблемы

### 1. **Неправильная индексация BCH таблицы**
**Файл:** `BCNav1Bit.cpp`, строка 288  
**Проблема:** Использовался индекс `svid` напрямую, но массив индексируется от 0  
**Исправление:** `BCH_prn_table[svid]` → `BCH_prn_table[svid-1]`

### 2. **Неправильное возвращаемое значение GetFrameData**
**Файл:** `BCNav1Bit.cpp`, строка 293  
**Проблема:** Функция возвращала 0 вместо длины кадра  
**Исправление:** `return 0` → `return 1800`

### 3. **Неинициализированный массив BdsSubframe3**
**Файл:** `BCNav1Bit.cpp`  
**Проблема:** Массив BdsSubframe3 использовался без инициализации  
**Исправления:**
- Добавлена инициализация в конструкторе
- Устранено использование локальной переменной вместо члена класса

### 4. **Критическое ограничение SVID ≤ 32**
**Файл:** `SatelliteSignal.cpp`, строка 174  
**Проблема:** Навигационные данные не генерировались для BeiDou спутников с номерами > 32  
**Исправление:** Добавлена проверка системы с правильными максимальными SVID:
- GPS: 32
- BeiDou: 63
- Galileo: 36
- GLONASS: 24

### 5. **Отсутствие QMBOC модуляции**
**Файлы:** `PrnGenerate.cpp`, `SatIfSignal.cpp`  
**Проблема:** Использовалась только BOC(1,1) для pilot канала вместо QMBOC(6,1,4/33)  
**Исправления:**
- Добавлен флаг `PRN_ATTRIBUTE_QMBOC`
- Реализована QMBOC модуляция в `GetPrnValue()`
- 4 из 33 символов используют BOC(6,1), остальные BOC(1,1)

## Технические детали QMBOC

QMBOC(6,1,4/33) модуляция для pilot канала B1C:
- 29/33 времени: BOC(1,1) 
- 4/33 времени: BOC(6,1) на позициях 1, 5, 7, 30
- Переключение синхронизировано с периодом 330 мс (33 символа × 10 мс)

## Результаты

После применения всех исправлений:
1. Навигационные данные корректно генерируются для всех BeiDou спутников (1-63)
2. Возвращается правильная длина кадра (1800 бит)
3. Subframe 3 инициализирован базовыми данными
4. Реализована стандартная QMBOC модуляция для pilot канала

## Рекомендации для дальнейшего улучшения

1. **Полная инициализация Subframe 3**: Необходимо заполнить реальными данными:
   - Ионосферные параметры
   - UTC коррекции
   - Параметры других систем GNSS

2. **Тестирование с различными приёмниками**: Проверить совместимость с:
   - Профессиональными GNSS приёмниками
   - SDR решениями
   - Чипсетами смартфонов

3. **Оптимизация QMBOC**: Возможно, потребуется точная настройка фаз BOC(6,1)

## Команды для тестирования

```bash
# Компиляция
cd IFdataGen && make clean && make

# Генерация только B1C сигнала
./IFdataGen ../presets/BDS_B1C_Only.json

# Генерация B1I + B1C (требует широкую полосу ~20 МГц)
./IFdataGen ../presets/BDS_B1I_B1C_18MHz.json
```