# Исправления навигационного сообщения ГЛОНАСС

## Дата: 2025-07-01

## Найденные и исправленные ошибки

### 1. Позиционирование tk в строке 1 (GNavBit.cpp)
**Проблема**: tk размещался в битах 0-11 вместо 9-20  
**Решение**: Исправлено позиционирование согласно ИКД ГЛОНАСС:
- Биты 9-13: часы (5 бит)
- Биты 14-19: минуты (6 бит)  
- Бит 20: 30-секундные интервалы (1 бит)

### 2. Отсутствие P2 в строке 1 (GNavBit.cpp)
**Проблема**: P2 не добавлялся в биты 81-85 строки 1  
**Решение**: Добавлен P2 с правильным значением:
- 01010 (0x0a) для четного tb
- 10101 (0x15) для нечетного tb

### 3. Отсутствие NT в строке 2 (GNavBit.cpp)
**Проблема**: Номер суток (NT) не передавался в строке 2  
**Решение**: Добавлен NT в биты 17-31 строки 2

### 4. Базовый год ГЛОНАСС (GnssTime.cpp)
**Проблема**: Использовался 1992 год вместо 1996  
**Решение**: Исправлен базовый год на 1996

### 5. Расчёт дня в 4-летнем цикле (GnssTime.cpp)
**Проблема**: Неправильный расчёт дней для високосных лет  
**Решение**: Исправлена логика с учетом того, что первый год цикла - високосный

### 6. Чтение tk из RINEX (Rinex.cpp)
**Проблема**: tk вычислялся из FrameTime вместо чтения из файла  
**Решение**: tk читается напрямую из data[2] и правильно форматируется

### 7. Документация (полная_структура_навигационных_сообщений.md)
**Проблема**: Неправильное описание полей tk  
**Решение**: Исправлено описание согласно ИКД ГЛОНАСС

## Текущий статус
Все критические ошибки исправлены. Навигационное сообщение ГЛОНАСС теперь формируется согласно официальному ИКД ГЛОНАСС.

## Файлы с изменениями:
1. `/src/GNavBit.cpp` - формирование навигационного сообщения
2. `/src/GnssTime.cpp` - преобразование времени
3. `/src/Rinex.cpp` - чтение эфемерид
4. `/docs/полная_структура_навигационных_сообщений.md` - документация