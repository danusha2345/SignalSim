# Тестирование полярности сигнала ГЛОНАСС
## Дата: 14 января 2025

## Базовая конфигурация (исправленная)

Согласно ICD ГЛОНАСС, сигнал формируется:
```
Модулирующая последовательность = PRN ⊕ NAV ⊕ MEANDER
```

## Варианты полярности для тестирования

### Вариант А: Инвертированный меандр (ТЕКУЩИЙ)
```cpp
int meander = ((currentMs / 10) % 2) ? 0 : 1;  // 0-5мс = 1, 5-10мс = 0
```
**Статус:** Активен в коде

### Вариант B: Инвертированная интерпретация навигационного бита
```cpp
int navBit = (DataSignal.real > 0) ? 1 : 0;  // Инверсия
```

### Вариант C: Инвертированная BPSK модуляция
```cpp
PrnValue = complex_number(modulatedBit ? 1.0 : -1.0, 0.0);  // 0 → -1, 1 → +1
```

### Вариант D: Комбинация A+B
Инвертированный меандр + инвертированный навигационный бит

### Вариант E: Комбинация A+C
Инвертированный меандр + инвертированная BPSK

### Вариант F: Комбинация B+C
Инвертированный навигационный бит + инвертированная BPSK

### Вариант G: Все три инверсии (A+B+C)
Все компоненты инвертированы

## Дополнительные проверки

### 1. Синхронизация меандра с границами строк
Возможно, меандр должен быть синхронизирован с началом 2-секундной строки:
```cpp
int stringStart = (currentMs / 2000) * 2000;
int relativeMs = currentMs - stringStart;
int meander = ((relativeMs / 10) % 2) ? 1 : 0;
```

### 2. Применение меандра к временной метке
Временная метка также должна модулироваться меандром через XOR.

### 3. Проверка фазы несущей
Возможно, проблема в фазе несущей для FDMA каналов.

## Отладочная информация

При тестировании каждого варианта следует проверять:
1. Меандр меняется каждые 10 мс (0→1→0→1...)
2. XOR работает корректно
3. Спектр сигнала содержит характерные линии 100 Гц

## Результаты тестирования

### Вариант базовый (без инверсий):
- Результат: спутники не видны

### Вариант А (только инвертированный меандр):
- Меандр инвертирован: 0-5мс = 1, 5-10мс = 0
- Результат: стабильно виден 1 спутник (SV13), другие 1-2 спутника появляются нестабильно

### Вариант A+B (инвертированный меандр + инвертированный навигационный бит):
- Меандр инвертирован: 0-5мс = 1, 5-10мс = 0
- Навигационный бит инвертирован: real > 0 → 1, real < 0 → 0
- Результат: стабильно видны 2 спутника (SV03 и SV13)

### Вариант A+B+C:
- Все три компонента инвертированы
- Результат: стабильно видны 2 спутника (как и в варианте A+B)

### Вариант B+C:
- Только навигационный бит и BPSK инвертированы
- Результат: хуже, спутники не видны

### ЛУЧШИЙ РЕЗУЛЬТАТ: Вариант A+B
- Инвертированный меандр + инвертированный навигационный бит
- Стабильно видны 2 спутника из 9 (SV03 и SV13)

## Примечания

1. Согласно некоторым источникам, полярность меандра может зависеть от:
   - Конкретной реализации приёмника
   - Версии ICD ГЛОНАСС
   - Соглашений о знаках в системе

2. В открытых реализациях (GNSS-SDR) используются разные варианты полярности

3. Важно: после изменения полярности необходимо перекомпилировать и заново сгенерировать сигнал