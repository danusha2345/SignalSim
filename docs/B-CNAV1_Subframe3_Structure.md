# Структура Subframe 3 в B-CNAV1 (BeiDou B1C)

## Общая информация

Subframe 3 в B-CNAV1 содержит вспомогательные навигационные данные и передаётся циклически с 4 различными типами страниц (Page Types).

### Параметры Subframe 3:
- **Длина до кодирования**: 264 бита (44 символа × 6 бит)
- **Длина после LDPC(88,44) кодирования**: 528 бит (88 символов × 6 бит)
- **Период передачи одной страницы**: 18 секунд
- **Полный цикл всех 4 страниц**: 72 секунды

## Типы страниц (Page Types) и их содержимое

### Page Type 1 - Параметры ионосферы и целостности
- **Message Type ID**: 1 (6 бит)
- **BDGIM параметры ионосферы** (74 бита):
  - α₀, α₁, α₂, α₃ - коэффициенты модели задержки
  - β₀, β₁, β₂, β₃ - коэффициенты широтной зависимости
- **Индикаторы целостности сигнала** (SISAI):
  - SISAI для B1C (4 бита)
  - SISAI для B2a (4 бита)
  - Флаги достоверности данных
- **Резерв**: оставшиеся биты

### Page Type 2 - Параметры времени UTC
- **Message Type ID**: 2 (6 бит)
- **BDT-UTC параметры** (97 бит):
  - A₀ᵤₜc - смещение BDT относительно UTC (32 бита)
  - A₁ᵤₜc - скорость изменения смещения (24 бита)
  - tₒᵤₜc - время применения параметров (8 бит)
  - WNₒᵤₜc - номер недели (8 бит)
  - ΔtLS - текущая секунда координации (8 бит)
  - WNLSF - неделя следующей секунды координации (8 бит)
  - DN - день недели изменения (3 бита)
  - ΔtLSF - будущая секунда координации (8 бит)
- **Статус здоровья спутников** (Health Status)
- **Резерв**: оставшиеся биты

### Page Type 3 - Параметры EOP и BGTO
- **Message Type ID**: 3 (6 бит)
- **EOP параметры** (Earth Orientation Parameters, 138 бит):
  - ΔUT1 - разница UT1-UTC
  - Δx, Δy - координаты полюса
  - Скорости изменения параметров
- **BGTO параметры** (BeiDou-GPS Time Offset, 68 бит):
  - A₀BGTO - смещение BDT-GPS
  - A₁BGTO - дрейф смещения
  - tBGTO - время применения
  - WNBGTO - номер недели
- **Резерв**: оставшиеся биты

### Page Type 4 - Сокращённый альманах
- **Message Type ID**: 4 (6 бит)
- **Midi/Reduced альманах** (переменная длина):
  - Данные альманаха для 1-2 спутников
  - Формат зависит от типа спутника (MEO/IGSO/GEO)
  - Включает орбитальные параметры и параметры часов
- **Резерв**: оставшиеся биты

## Формат данных в коде

В текущей реализации BCNavBit определены следующие массивы для хранения данных Subframe 3:

```cpp
unsigned int BdGimIono[4];        // BDGIM ионосферные параметры (74 бита)
unsigned int BdtUtcParam[5];      // BDT-UTC параметры (97 бит)
unsigned int EopParam[6];         // EOP параметры (138 бит)
unsigned int BgtoParam[7][3];     // BGTO параметры (68 бит для каждой системы)
unsigned int ReducedAlmanac[63][2];  // Сокращённый альманах (38 бит)
unsigned int MidiAlmanac[63][7];     // Midi альманах (156 бит)
```

## Рекомендации по реализации

Для правильной инициализации Subframe 3 необходимо:

1. **Установить Message Type ID** в первых 6 битах каждой страницы
2. **Заполнить данные** из соответствующих массивов BCNavBit
3. **Применить выравнивание** - дополнить нулями до 264 бит
4. **Рассчитать CRC** перед LDPC кодированием

### Пример инициализации Page Type 1 (ионосфера):
```cpp
// Установка Message Type ID = 1
BdsSubframe3[0][0] = (1 << 17) & 0x7E0000;  // биты 22-17

// Копирование BDGIM параметров
memcpy(&BdsSubframe3[0][0], BdGimIono, sizeof(unsigned int) * 3);
// Последний параметр частично
BdsSubframe3[0][3] = BdGimIono[3] & 0xFFFF0000;
```

## Важные замечания

1. **Циклическая передача**: Страницы 1-4 передаются последовательно
2. **Синхронизация**: Page counter = (frame_number / 200) % 4
3. **Обновление данных**: Ионосферные и UTC параметры обновляются редко (часы/дни)
4. **Совместимость**: Приёмники могут работать без полных данных Subframe 3, но с пониженной точностью