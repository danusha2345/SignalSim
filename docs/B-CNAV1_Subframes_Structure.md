# Структура субфреймов B-CNAV1 (BeiDou B1C)

## Общая информация о B-CNAV1

B-CNAV1 навигационное сообщение состоит из трёх субфреймов, передаваемых каждые 18 секунд (1800 бит):
- **Subframe 1**: 72 бита (BCH кодирование)
- **Subframe 2**: 1200 бит (LDPC кодирование)
- **Subframe 3**: 528 бит (LDPC кодирование)

## Subframe 1 - Синхронизация и номер спутника

### Структура (72 бита):
1. **PRN** (21 бит) - BCH закодированный SVID спутника
   - Использует таблицу `BCH_prn_table[svid-1]`
   - Позволяет приёмнику идентифицировать спутник

2. **SOH** (51 бит) - Second of Hour (время внутри часа)
   - BCH закодированное значение текущей секунды в часе
   - Диапазон: 0-1799 (соответствует 0-1799 секундам = 0-29.98 минутам)
   - Использует таблицу `BCH_soh_table[soh]`
   - Разделено на две части: 19 бит (старшие) + 32 бита (младшие)

### Назначение:
- Быстрая синхронизация приёмника
- Определение времени передачи сообщения
- Идентификация спутника без декодирования основного сообщения

## Subframe 2 - Основные навигационные данные

### Структура (600 бит до кодирования → 1200 после LDPC):

1. **Заголовок** (24 бита):
   - **WN** (11 бит) - Week Number (номер недели BDS)
   - **HOW** (8 бит) - Hour of Week (час недели)
   - **IODC** (5 бит) - Issue of Data Clock (начало из ClockParam)

2. **Ephemeris 1** (211 бит) - Орбитальные параметры часть 1:
   - **IODE** - Issue of Data Ephemeris
   - **toe** - Время применения эфемерид
   - **√A** - Квадратный корень большой полуоси
   - **e** - Эксцентриситет
   - **ω** - Аргумент перигея
   - **Δn** - Коррекция среднего движения
   - **M₀** - Средняя аномалия на эпоху

3. **Ephemeris 2** (222 бита) - Орбитальные параметры часть 2:
   - **Ω₀** - Долгота восходящего узла
   - **i₀** - Наклонение орбиты
   - **Ω̇** - Скорость изменения долготы восходящего узла
   - **IDOT** - Скорость изменения наклонения
   - **Cuc, Cus** - Коррекции аргумента широты (cos/sin)
   - **Crc, Crs** - Коррекции радиуса (cos/sin)
   - **Cic, Cis** - Коррекции наклонения (cos/sin)

4. **Clock Parameters** (69 бит) - Параметры часов спутника:
   - **toc** - Время применения параметров часов
   - **af₀** - Смещение часов спутника
   - **af₁** - Дрейф часов спутника
   - **af₂** - Ускорение дрейфа часов

5. **TGS/ISC Parameters** (36 бит) - Групповые задержки:
   - **TGD_B1C** - Групповая задержка для B1C
   - **TGD_B2a** - Групповая задержка для B2a
   - **ISC_B2b** - Inter-Signal Correction для B2b

### Кодирование:
- LDPC(200,100) матрица хранится в `B1CMatrixGen2`
- После кодирования 600 бит превращаются в 1200 бит

## Subframe 3 - Вспомогательные данные

Содержит 4 типа страниц (циклически):

### Page Type 1 - Ионосферные параметры:
- BDGIM модель ионосферы (74 бита)
- Параметры целостности сигнала

### Page Type 2 - UTC параметры:
- BDT-UTC смещение (97 бит)
- Статус здоровья спутников

### Page Type 3 - EOP и BGTO:
- Earth Orientation Parameters (138 бит)
- BeiDou-GPS Time Offset (68 бит)

### Page Type 4 - Альманах:
- Сокращённые данные альманаха для других спутников

## Важные особенности реализации

1. **Interleaving (чередование)**:
   - После кодирования биты из Subframe 2 и 3 чередуются
   - 11 раундов по 3 строки: 2 из Subframe 2, 1 из Subframe 3
   - Последние 3 строки только из Subframe 2

2. **Временная синхронизация**:
   - Каждый кадр длится 18 секунд
   - SOH обновляется каждые 2 секунды (кадр содержит 9 SOH значений)
   - Страницы Subframe 3 меняются каждые 18 секунд

3. **Формат данных**:
   - Все данные упакованы в 24-битные слова (unsigned int)
   - 6-битные символы используются для LDPC кодирования
   - MSB first (старший бит первый)

## Использование данных

Эти субфреймы содержат всю необходимую информацию для:
- **Позиционирования**: точные орбитальные параметры и время
- **Коррекции ошибок**: параметры часов, групповые задержки
- **Атмосферные коррекции**: ионосферные параметры (Subframe 3)
- **Межсистемная совместимость**: BGTO для работы с GPS

Все параметры обновляются из RINEX файлов через функции:
- `SetEphemeris()` - для орбитальных данных и часов
- `SetAlmanac()` - для альманаха
- `SetIonoUtc()` - для ионосферы и UTC (требует реализации)