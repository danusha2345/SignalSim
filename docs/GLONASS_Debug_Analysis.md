# Анализ проблемы ГЛОНАСС - видны только 1-2 спутника
## Дата: 14 января 2025

## Важное наблюдение
Раз приёмник видит 1-2 спутника (SV03 и SV13), значит:
- ✅ Модуляция в принципе работает
- ✅ Меандр применяется правильно (иначе не было бы ни одного спутника)
- ✅ XOR трёх компонентов реализован корректно
- ❌ Но есть проблемы с остальными спутниками

## Симптомы
1. Стабильно видны только SV03 и SV13 из 9 возможных
2. Данные по часам не загружаются (приёмник не может декодировать навигационное сообщение)
3. Другие спутники иногда появляются и исчезают

## Возможные причины

### 1. Проблема с навигационным сообщением
Если приёмник видит спутники, но не может загрузить данные часов, это указывает на:
- Неправильную структуру навигационного сообщения
- Ошибки в коде Хэмминга
- Неправильное заполнение данных в строках

### 2. Проблема с временной синхронизацией
- Неправильная синхронизация границ строк (2 секунды)
- Неправильная привязка временной метки к началу строки
- Рассинхронизация между временной меткой и данными

### 3. Проблема с частотными каналами FDMA
Возможно, SV03 и SV13 используют определённые частотные каналы, для которых:
- Правильно рассчитывается доплеровский сдвиг
- Правильно работает модуляция
- А для других каналов есть ошибки

### 4. Проблема с эфемеридами
- Некоторые спутники могут иметь невалидные эфемериды
- Неправильно рассчитываются параметры для некоторых спутников

## Диагностические шаги

### 1. Проверить навигационное сообщение
```cpp
// Добавить отладку в GNavBit.cpp
printf("[GLONASS NAV] String %d: ", stringNumber);
for (int i = 0; i < 100; i++) {
    printf("%d", DataBits[i]);
}
printf("\n");
```

### 2. Проверить код Хэмминга
```cpp
// Проверить, правильно ли вычисляется контрольная сумма
uint8_t calculated = CalculateHammingCode(DataBits);
printf("[GLONASS] Hamming code: calculated=%02X\n", calculated);
```

### 3. Проверить частотные каналы
Нужно выяснить, какие частотные каналы используют видимые спутники SV03 и SV13.

### 4. Проверить временные параметры
- Убедиться, что временная метка синхронизирована с началом строки
- Проверить, что навигационные данные начинаются после 300 мс

## Рекомендации

### 1. Добавить расширенную отладку
Вывести для каждого спутника:
- Частотный канал
- Статус эфемерид
- Первые биты навигационного сообщения
- Временную синхронизацию

### 2. Проверить заполнение строки 4
В строке 4 передаются критические параметры часов:
- τc (смещение ГЛОНАСС от UTC)
- τGPS (смещение от GPS)
- Флаги валидности

Если эти параметры неправильные, приёмник не сможет синхронизировать часы.

### 3. Сравнить параметры SV03 и SV13
Найти, что общего у этих двух спутников:
- Частотные каналы
- Параметры эфемерид
- Флаги состояния

## Заключение
Проблема не в модуляции (она работает для 2 спутников), а скорее всего в:
1. Структуре навигационного сообщения
2. Временной синхронизации
3. Специфике определённых частотных каналов FDMA