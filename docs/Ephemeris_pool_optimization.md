# Оптимизация пула эфемерид и исправление BDS недели

## Дата: 2025-01-15

### Изменения из коммита efbae1d

#### 1. Оптимизация увеличения размера пула эфемерид

**Проблема:** При добавлении новых эфемерид размер массива увеличивался на фиксированное значение (100 элементов), что неэффективно при большом количестве данных.

**Решение:** Теперь размер массива удваивается при переполнении:
- Изменено `EPH_NUMBER_INC` на `EPH_NUMBER_INIT` (начальный размер)
- Вместо `PoolSize += 100` используется `PoolSize *= 2`
- Это стандартная оптимизация для динамических массивов (аналогично std::vector)

**Преимущества:**
- Меньше операций realloc при большом количестве эфемерид
- Амортизированная сложность O(1) для добавления элемента
- Лучшая производительность при длительной работе программы

#### 2. Исправление BDS недели в CNAV2 и CNAV3

**Проблема:** BCNav2Bit и BCNav3Bit использовали GPS неделю вместо BDS недели.

**Решение:** Добавлено вычитание 1356 (разница между GPS и BDS эпохами):
```cpp
ComposeMessage(MessageType, StartTime.Week - 1356, sow, svid, FrameData);
```

**Примечание:** BCNav1Bit уже использовал правильную BDS неделю.

#### 3. Добавление midi-almanac и reduced almanac в BDS CNAV3 message type 40

**Проблема:** Message type 40 был пустым заполнителем.

**Решение:** Полностью реализована передача данных альманаха:
- Добавлены поля AlmanacWeek и AlmanacToa в BCNavBit
- Реализована функция FillBdsAlmanacPage для заполнения midi и reduced альманаха
- В message type 40 теперь передаются:
  - BGTO параметры (3 поля по sow % 3)
  - 1 midi almanac (156 бит) для спутника sow % 63
  - 5 reduced almanac (по 38 бит) для спутников (sow * 5 + i) % 63

**Особенности реализации:**
- Midi almanac содержит полные орбитальные параметры
- Reduced almanac содержит сокращённые параметры для быстрого поиска
- Параметр delta_i учитывает разницу наклонения для MEO (0°) и IGSO (0.3 рад)
- Параметр deltaA учитывает разницу большой полуоси для GEO и MEO/IGSO

### Изменённые файлы:
- inc/NavData.h - переименован макрос
- src/NavData.cpp - изменена логика увеличения размера для всех систем
- src/BCNav2Bit.cpp - исправлена BDS неделя
- src/BCNav3Bit.cpp - исправлена BDS неделя, добавлена полная реализация message type 40
- inc/BCNavBit.h - добавлены поля AlmanacWeek и AlmanacToa
- src/BCNavBit.cpp - реализована функция FillBdsAlmanacPage, обновлён SetAlmanac