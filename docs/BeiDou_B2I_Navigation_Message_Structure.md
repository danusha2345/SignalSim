# Структура навигационного сообщения BeiDou B2I

## Обзор

Сигнал BeiDou B2I передаёт навигационное сообщение D2, которое структурно похоже на сообщение D1, используемое на B1I, но с некоторыми отличиями. Сигнал B2I передаётся на частоте 1207.14 МГц и использует BPSK модуляцию.

## Характеристики сигнала

- **Частота**: 1207.14 МГц
- **Модуляция**: BPSK(2)
- **Скорость передачи чипов**: 2.046 Мчип/с
- **Скорость передачи данных**: 500 бит/с (1000 симв/с с FEC 1/2)
- **Длительность кадра**: 3 секунды
- **Длительность суперкадра**: 3 минуты (60 кадров)

## Иерархия структуры сообщения

```
Суперкадр (3 минуты = 180 секунд)
├── 60 Кадров (3 секунды каждый)
    ├── 5 Подкадров (0.6 секунд каждый)
        ├── 10 Слов (30 бит каждое)
```

## Как компонуется навигационное сообщение

### Уровень суперкадра
Суперкадр - это полное навигационное сообщение, содержащее всю необходимую информацию для навигации. Он состоит из 60 кадров и передаётся за 3 минуты.

### Уровень кадра
Каждый кадр длится 3 секунды и содержит:
- 1500 бит данных
- 5 подкадров по 300 бит каждый

### Уровень подкадра
Каждый подкадр содержит:
- 300 бит данных
- 10 слов по 30 бит
- Первое слово всегда содержит преамбулу и идентификатор подкадра

## Детальная структура кадра

### Подкадр 1 - Параметры часов и состояние спутника

**Назначение**: Передача параметров бортовых часов спутника и информации о его состоянии.

**Структура слов:**

**Слово 1 (биты 1-30):**
- Биты 1-4: Зарезервировано
- Биты 5-15: Преамбула (11101010110b) - фиксированная последовательность для синхронизации
- Биты 16-18: ID подкадра (001b для подкадра 1)
- Биты 19-22: Зарезервировано
- Биты 23-30: Биты четности

**Слово 2 (биты 31-60):**
- Биты 31-36: Старшие биты номера недели (WN биты 7-12)
- Биты 37-43: Индекс точности дальности (URAI)
- Биты 44-52: Состояние здоровья спутника (SatH1)
- Биты 53-60: IODC (Issue of Data Clock) - версия данных часов

**Слово 3 (биты 61-90):**
- Биты 61-67: AODC (Age of Data Clock) - возраст данных часов
- Биты 68-71: toc MSB (старшие биты времени привязки часов)
- Биты 72-90: toc LSB (младшие биты времени привязки часов)
- Масштаб: 2^3 секунды

**Слово 4 (биты 91-120):**
- Биты 91-98: a0 MSB (старшие биты смещения часов)
- Биты 99-120: a0 LSB (младшие биты смещения часов)
- Масштаб: 2^-33 секунды

**Слово 5 (биты 121-150):**
- Биты 121-142: a1 (дрейф часов)
- Масштаб: 2^-50 сек/сек
- Биты 143-150: Биты четности

**Слово 6 (биты 151-180):**
- Биты 151-161: a2 (ускорение дрейфа часов)
- Масштаб: 2^-66 сек/сек²
- Биты 162-180: Зарезервировано и биты четности

**Слова 7-10**: Зарезервированы для будущего использования и содержат биты четности

### Подкадры 2-3 - Эфемериды спутника

**Назначение**: Передача точных орбитальных параметров спутника.

#### Подкадр 2 содержит:

**Слово 1**: Преамбула и ID подкадра (как в подкадре 1, но ID = 010b)

**Слово 2**:
- IODE (Issue of Data Ephemeris) - версия эфемерид (8 бит)
- Δn (отклонение среднего движения) - начало (22 бита)
- Масштаб: 2^-43 полуокружностей/сек

**Слово 3**:
- Δn - продолжение (10 бит)
- Cuc (амплитуда косинусоидальной гармоники аргумента широты) (18 бит)
- Масштаб: 2^-31 радиан

**Слово 4**:
- M0 (средняя аномалия на момент привязки) - старшие биты (32 бита)
- Масштаб: 2^-31 полуокружностей

**Слово 5**:
- e (эксцентриситет) - старшие биты (32 бита)
- Масштаб: 2^-33

**Слово 6**:
- Cus (амплитуда синусоидальной гармоники аргумента широты) (18 бит)
- Масштаб: 2^-31 радиан

**Слово 7**:
- Crc (амплитуда косинусоидальной гармоники радиуса орбиты) (18 бит)
- Масштаб: 2^-6 метров

**Слово 8**:
- Crs (амплитуда синусоидальной гармоники радиуса орбиты) (18 бит)
- Масштаб: 2^-6 метров

**Слово 9**:
- √A (квадратный корень большой полуоси) - старшие биты (32 бита)
- Масштаб: 2^-19 метров^1/2

**Слово 10**:
- toe (время привязки эфемерид) - младшие биты (17 бит)
- Масштаб: 2^3 секунды

#### Подкадр 3 содержит:

**Слово 1**: Преамбула и ID подкадра (ID = 011b)

**Слово 2**:
- toe - старшие биты (10 бит)
- i0 (наклонение на момент привязки) - начало (22 бита)
- Масштаб: 2^-31 полуокружностей

**Слово 3**:
- i0 - продолжение (10 бит)
- Cic (амплитуда косинусоидальной гармоники наклонения) (18 бит)
- Масштаб: 2^-31 радиан

**Слово 4**:
- Ω0 (долгота восходящего узла) (32 бита)
- Масштаб: 2^-31 полуокружностей

**Слово 5**:
- Cis (амплитуда синусоидальной гармоники наклонения) (18 бит)
- Масштаб: 2^-31 радиан

**Слово 6**:
- IDOT (скорость изменения наклонения) (14 бит)
- Масштаб: 2^-43 полуокружностей/сек

**Слово 7**:
- ΩDOT (скорость прецессии восходящего узла) (24 бита)
- Масштаб: 2^-43 полуокружностей/сек

**Слово 8**:
- ω (аргумент перигея) (32 бита)
- Масштаб: 2^-31 полуокружностей

### Подкадры 4-5 - Альманах и служебная информация

Эти подкадры содержат 60 страниц (по 30 на подкадр), которые циклически передаются в разных кадрах суперкадра.

**Содержание страниц:**

**Страницы 1-24**: Альманах для спутников 1-24
Каждая страница содержит:
- √A (квадратный корень большой полуоси) - 24 бита, масштаб 2^-11 м^1/2
- a1 (дрейф часов) - 11 бит, масштаб 2^-38 с/с
- a0 (смещение часов) - 11 бит, масштаб 2^-20 с
- Ω0 (долгота восходящего узла) - 24 бита, масштаб 2^-23 полуокружностей
- e (эксцентриситет) - 17 бит, масштаб 2^-21
- δi (поправка к наклонению) - 16 бит, масштаб 2^-19 полуокружностей
- toe (время привязки альманаха) - 8 бит, масштаб 2^12 с
- ΩDOT (скорость прецессии) - 17 бит, масштаб 2^-38 полуокружностей/с
- ω (аргумент перигея) - 24 бита, масштаб 2^-23 полуокружностей
- M0 (средняя аномалия) - 24 бита, масштаб 2^-23 полуокружностей

**Страницы 25-30**: Параметры ионосферы (страница 25)
- α0, α1, α2, α3 - коэффициенты кубической модели (по 8 бит)
- β0, β1, β2, β3 - коэффициенты кубической модели (по 8 бит)

**Страницы 31-36**: Параметры времени UTC (страница 31)
- A0UTC - смещение UTC (32 бита), масштаб 2^-30 с
- A1UTC - дрейф UTC (24 бита), масштаб 2^-50 с/с
- ΔtLS - текущие високосные секунды (8 бит)
- WNLSF - номер недели високосной секунды (8 бит)
- DN - день недели високосной секунды (8 бит)
- ΔtLSF - будущие високосные секунды (8 бит)

**Страницы 37-60**: Смещения времени между системами
- A0GPS - смещение BDT-GPS (14 бит), масштаб 0.1 нс
- A1GPS - дрейф BDT-GPS (16 бит), масштаб 0.1 нс/с
- A0GAL - смещение BDT-Galileo (14 бит), масштаб 0.1 нс
- A1GAL - дрейф BDT-Galileo (16 бит), масштаб 0.1 нс/с
- A0GLO - смещение BDT-GLONASS (14 бит), масштаб 0.1 нс
- A1GLO - дрейф BDT-GLONASS (16 бит), масштаб 0.1 нс/с

## Обнаружение и исправление ошибок

### BCH код (15,11,1)
Каждое слово защищено 4 битами четности с использованием BCH кода, который может:
- Обнаруживать до 2 битовых ошибок
- Исправлять 1 битовую ошибку

### Перемежение
Данные перемежаются внутри подкадра для защиты от пакетных ошибок.

## Процесс компоновки сообщения

1. **Формирование слов**: Параметры упаковываются в 30-битные слова согласно спецификации
2. **Добавление четности**: К каждому слову добавляются 4 бита BCH четности
3. **Формирование подкадров**: 10 слов объединяются в подкадр с преамбулой в первом слове
4. **Формирование кадров**: 5 подкадров объединяются в кадр
5. **Формирование суперкадра**: 60 кадров передаются последовательно

## Особенности реализации

1. **Синхронизация**: Приёмник ищет преамбулу 11101010110b для синхронизации
2. **Проверка целостности**: Проверяются биты четности BCH
3. **Извлечение параметров**: Биты извлекаются согласно позициям и применяются масштабные коэффициенты
4. **Проверка актуальности**: Проверяется возраст данных (AODC, AODE)
5. **Валидация**: Проверяются диапазоны параметров и флаги состояния