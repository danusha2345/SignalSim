# Исправление размещения битов ГЛОНАСС согласно таблице 4.6 ICD

## Дата: 2025-01-15

### Проблема
Размещение битов в навигационном сообщении ГЛОНАСС не соответствовало таблице 4.6 ICD ГЛОНАСС.

### Обнаруженные ошибки:
1. **Bn в строке 1**: размещался в позиции 79 вместо 80
2. **Bn в строке 2**: записывался только 1 бит из 3 (должно быть в позициях 78-80)
3. **P2 в строке 2**: записывались 2 бита вместо 1 в позицию 77
4. **P в строке 3**: отсутствовал (должен быть в позициях 66-67)
5. **P4 в строке 4**: размещался в позиции 49 вместо 34
6. **ln для нечётных строк**: не реализован

### Выполненные исправления в GNavBit.cpp:

#### Строка 1:
```cpp
// Было:
String[0][0] |= COMPOSE_BITS(Ephemeris->Bn, 14, 1);      // Позиция 79
String[0][0] |= COMPOSE_BITS(Ephemeris->P, 15, 2);       // P1

// Стало:
String[0][0] |= COMPOSE_BITS(Ephemeris->Bn, 16, 1);      // Позиция 80
String[0][0] |= COMPOSE_BITS(Ephemeris->P & 0x3, 14, 2); // P1 (позиции 77-78)
```

#### Строка 2:
```cpp
// Было:
String[1][0] |= COMPOSE_BITS(Ephemeris->Bn, 16, 1);      // Только 1 бит
String[1][0] |= COMPOSE_BITS(Ephemeris->P >> 2, 14, 2);  // 2 бита

// Стало:
String[1][0] |= COMPOSE_BITS(Ephemeris->Bn >> 1, 14, 3); // 3 бита Bn (позиции 78-80)
String[1][0] |= COMPOSE_BITS((Ephemeris->P >> 2) & 0x1, 13, 1); // 1 бит P2 (позиция 77)
```

#### Строка 3:
```cpp
// Добавлено:
String[2][0] |= COMPOSE_BITS(0, 4, 1);                    // ln (позиция 65)
String[2][0] |= COMPOSE_BITS((Ephemeris->P >> 4) & 0x3, 2, 2); // P (позиции 66-67)
```

#### Строка 4:
```cpp
// Было:
String[3][1] |= COMPOSE_BITS(Ephemeris->P >> 4, 16, 1);  // Позиция 49

// Стало:
String[3][1] |= COMPOSE_BITS((Ephemeris->P >> 6) & 0x1, 1, 1); // P4 (позиция 34)
```

### Примечания:
1. Параметр P теперь корректно распределяется по строкам:
   - Биты 0-1 → P1 в строке 1
   - Бит 2 → P2 в строке 2
   - Бит 3 → P3 в строке 3
   - Биты 4-5 → P в строке 3
   - Бит 6 → P4 в строке 4

2. Параметр Bn (4 бита) распределяется:
   - Бит 0 → строка 1, позиция 80
   - Биты 1-3 → строка 2, позиции 78-80

3. ln для нечётных строк пока установлен в 0, требуется дальнейшая реализация логики его установки

### Результат:
Размещение битов теперь соответствует таблице 4.6 ICD ГЛОНАСС.