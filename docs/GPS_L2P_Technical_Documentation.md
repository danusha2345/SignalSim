# GPS L2P Техническая документация

## Обзор сигнала GPS L2P

GPS L2P (Precision code) - это зашифрованный военный сигнал на частоте L2 (1227.60 МГц), использующий P(Y)-код. В гражданских приложениях используется упрощенная версия P-кода для моделирования.

## Технические характеристики

### Основные параметры
- **Несущая частота**: 1227.60 МГц (120 × 10.23 МГц)
- **Код**: P-код (Precision code)
- **Чип рейт**: 10.23 Мчип/с
- **Период кода**: 7 дней (полный P-код)
- **Модуляция**: BPSK
- **Навигационное сообщение**: LNAV (Legacy Navigation Message)
- **Скорость данных**: 50 бит/с
- **Мощность**: -160 дБВт (минимальная принимаемая)

### Структура сигнала
```
L2P(t) = A_P × P(t) × D(t) × cos(2πf_L2×t + φ)
```
где:
- A_P - амплитуда сигнала
- P(t) - P-код
- D(t) - навигационные данные (LNAV)
- f_L2 - несущая частота L2
- φ - начальная фаза

## P-код (Precision code)

### Характеристики P-кода
- **Генератор**: Комбинация четырех 12-битных регистров сдвига
- **Период**: 2.3547 × 10^14 чипов (≈ 7 дней)
- **Чип рейт**: 10.23 Мчип/с
- **Уникальность**: Каждый спутник использует недельный сегмент P-кода

### Упрощенная генерация P-кода
В симуляторе используется упрощенная версия P-кода с периодом 10230 чипов (1 мс):

```cpp
// Начальные состояния для упрощенного P-кода (32 спутника)
unsigned int L2PPrnInit[32] = {
    // Уникальные начальные состояния для каждого PRN
};

// Генерация упрощенного P-кода
void GetSimplifiedPCode(unsigned int prn, unsigned char *pcode) {
    unsigned int g1 = 0x3FF;  // Все единицы для X1A
    unsigned int g2 = L2PPrnInit[prn-1];  // Начальное состояние X2A
    
    for (int i = 0; i < 10230; i++) {
        // Выход = X1A[10] ⊕ X2A[10]
        pcode[i] = ((g1 >> 9) & 0x1) ^ ((g2 >> 9) & 0x1);
        
        // Обратная связь и сдвиг регистров
        // ... (детали реализации)
    }
}
```

## Навигационное сообщение LNAV

L2P использует тот же формат навигационного сообщения LNAV, что и L1 C/A:

### Структура кадра
- **Длина кадра**: 1500 бит (30 секунд)
- **Подкадры**: 5 подкадров по 300 бит каждый
- **Слова**: 10 слов по 30 бит в каждом подкадре
- **Полное сообщение**: 25 кадров (12.5 минут)

### Содержание подкадров
1. **Подкадр 1**: Параметры часов спутника, здоровье
2. **Подкадр 2**: Эфемериды (часть 1)
3. **Подкадр 3**: Эфемериды (часть 2)
4. **Подкадр 4**: Альманах, ионосферные параметры, UTC
5. **Подкадр 5**: Альманах, здоровье спутников

### Формат слова (30 бит)
```
[Данные (24 бита)][Четность (6 бит)]
```

## Особенности модуляции

### BPSK модуляция
- Бинарная фазовая манипуляция
- Фазовый сдвиг 180° для представления битов
- Отсутствие BOC модуляции (в отличие от современных сигналов)

### Спектральные характеристики
- Основная полоса: ±10.23 МГц от несущей
- Первый ноль спектра: на частоте чип рейта (10.23 МГц)
- Спектральная плотность мощности: sinc²(f/fc)

## Реализация в симуляторе

### Параметры в коде
```cpp
// BasicTypes.h
#define SIGNAL_INDEX_L2P 3

// PrnGenerate.cpp - атрибуты PRN
{ 10230, 10230*2, 10230*2, 0 }  // chip/ms, data period, pilot period, BOC

// SatelliteSignal.cpp - привязка к навигационному сообщению
case SIGNAL_INDEX_L2P:
    Attribute = &SignalAttributes[0];  // Использует LNAV как L1CA
    return NavData ? ((typeid(*NavData) == typeid(LNavBit)) ? TRUE : FALSE) : TRUE;
```

### Генерация сигнала
1. Генерация упрощенного P-кода (10230 чипов)
2. Модуляция навигационными данными LNAV
3. BPSK модуляция на несущей L2
4. Добавление доплеровского сдвига

## Применение

### Военное использование
- Точное позиционирование с P(Y)-кодом
- Устойчивость к помехам
- Антиспуфинг защита

### Гражданское использование
- Двухчастотные измерения (L1/L2)
- Компенсация ионосферных задержек
- Улучшение точности позиционирования
- Кодовые измерения без несущей (Z-tracking)

## Сравнение с другими GPS сигналами

| Параметр | L1 C/A | L2C | L2P | L5 |
|----------|--------|-----|-----|-----|
| Частота (МГц) | 1575.42 | 1227.60 | 1227.60 | 1176.45 |
| Чип рейт (Мчип/с) | 1.023 | 0.5115/1.023 | 10.23 | 10.23 |
| Модуляция | BPSK | BPSK | BPSK | BPSK |
| Навигационное сообщение | LNAV | CNAV | LNAV | CNAV |
| Доступность | Гражданская | Гражданская | Военная | Гражданская |

## Известные проблемы и решения

### Проблема отсутствия обработки L2P в симуляторе
**Симптом**: Segmentation fault при генерации L2P сигнала

**Причина**: Отсутствие обработки `SIGNAL_INDEX_L2P` в функции `SetSignalAttribute()`

**Решение**: Добавление case для L2P в switch statement:
```cpp
case SIGNAL_INDEX_L2P:
    Attribute = &SignalAttributes[0];  // L2P uses LNAV like L1CA
    return NavData ? ((typeid(*NavData) == typeid(LNavBit)) ? TRUE : FALSE) : TRUE;
```

## Ссылки и стандарты

1. **IS-GPS-200**: Interface Specification for GPS Space Segment/Navigation User Interfaces
2. **ICD-GPS-870**: Navstar GPS Space Segment/User Segment L5 Interfaces
3. **Упрощенная модель P-кода**: Основана на публичных описаниях структуры генератора

## Примечания по реализации

1. Используется упрощенная версия P-кода для моделирования
2. Реальный P(Y)-код зашифрован и недоступен для гражданского использования
3. Период упрощенного кода 1 мс вместо 7 дней для оптимизации памяти
4. Навигационное сообщение идентично L1 C/A (LNAV формат)