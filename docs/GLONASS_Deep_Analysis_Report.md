# Глубокий анализ реализации ГЛОНАСС - Итоговый отчет

## Дата: 13 января 2025

## Резюме

Проведен глубокий анализ реализации ГЛОНАСС в проекте IFdataGen. Выявлены потенциальные проблемы, которые могут препятствовать обнаружению сигналов приёмниками.

## 1. Анализ временной метки

### Текущая реализация
- **Значение**: 0x1B8593A0 (461738912 в десятичной системе)
- **Двоичное представление**: 011011100001011001001110100000 (30 бит)
- **Статистика**: 13 единиц (43.3%), 17 нулей (56.7%)
- **Особенности**: Содержит последовательность из 5 нулей в конце

### Потенциальные проблемы

1. **Неверное значение временной метки**
   - Значение 0x1B8593A0 может не соответствовать официальному стандарту ICD ГЛОНАСС
   - Необходимо проверить в официальной документации точное значение "укороченной ПСП"

2. **Полярность модуляции**
   ```cpp
   // Текущая реализация
   DataBit = (TimeMarkerBits[TimeMarkerBitIndex] ? -1 : 1);
   ```
   - Бит 1 → амплитуда -1
   - Бит 0 → амплитуда +1
   - Возможно, требуется инверсия полярности

3. **Порядок передачи битов**
   - Возможно, биты должны передаваться в обратном порядке (LSB первым)
   - Или требуется другой формат кодирования

## 2. Анализ частот FDMA

### Реализация корректна
- **G1**: 1602 МГц + n × 562.5 кГц
- **G2**: 1246 МГц + n × 437.5 кГц
- **Частотные каналы**: от -7 до +6 (правильно)
- **Распределение по слотам**: соответствует стандарту

## 3. Анализ временной структуры

### Реализация корректна
- **Длительность строки**: 2000 мс ✓
- **Временная метка**: 300 мс (30 бит × 10 мс/бит) ✓
- **Навигационные данные**: 1700 мс (100 бит × 17 мс/бит) ✓
- **Структура переходов**: правильная

## 4. Анализ навигационного сообщения

### Реализация корректна
- **Код Хэмминга (93,85)**: правильно реализован ✓
- **Структура 100 бит**: 8 бит КС + 7 бит заполнения + 85 бит данных ✓
- **Относительное кодирование**: удалено (правильно) ✓

## 5. Возможные варианты временной метки

На основе анализа предлагаются следующие варианты для проверки:

1. **Инвертированное значение**: 0x247A6C5F
2. **Обратный порядок битов**: 0x01726876
3. **Обратный порядок байтов**: 0x2824E146
4. **Циклические сдвиги**: 0x370B2740, 0x2E164E81, и др.

## 6. Рекомендации по исправлению

### Приоритет 1: Проверка значения временной метки
1. Найти в ICD ГЛОНАСС точное значение укороченной ПСП
2. Сравнить с используемым значением 0x1B8593A0

### Приоритет 2: Эксперименты с полярностью
1. Попробовать инвертировать полярность временной метки:
   ```cpp
   DataBit = (TimeMarkerBits[TimeMarkerBitIndex] ? 1 : -1);
   ```

2. Проверить полярность для всей системы модуляции

### Приоритет 3: Проверка порядка битов
1. Попробовать передавать биты временной метки в обратном порядке
2. Проверить формат кодирования (NRZ, манчестерское, и т.д.)

### Приоритет 4: Анализ с помощью SDR
1. Записать генерируемый сигнал
2. Проанализировать спектр и временную структуру
3. Сравнить с записью реального сигнала ГЛОНАСС

## 7. Код для экспериментов

### Эксперимент 1: Инверсия полярности
```cpp
// В файле SatelliteSignal.cpp, строка ~760
// Заменить:
DataBit = (TimeMarkerBitIndex < 30) ? (TimeMarkerBits[TimeMarkerBitIndex] ? -1 : 1) : 1;
// На:
DataBit = (TimeMarkerBitIndex < 30) ? (TimeMarkerBits[TimeMarkerBitIndex] ? 1 : -1) : 1;
```

### Эксперимент 2: Другое значение временной метки
```cpp
// В файле GNavBit.cpp, функция GetTimeMarker
// Попробовать другие значения:
const unsigned int TIME_MARK = 0x247A6C5F;  // Инвертированное
// или
const unsigned int TIME_MARK = 0x01726876;  // Обратный порядок битов
```

### Эксперимент 3: Обратный порядок битов
```cpp
// В функции GetTimeMarker добавить:
for (int i = 0; i < MARK_LENGTH; i++)
{
    // Обратный порядок
    TimeMarkerBits[i] = (TIME_MARK >> i) & 1;
}
```

## 8. Заключение

Наиболее вероятные причины невидимости сигналов ГЛОНАСС:

1. **Неправильное значение временной метки** (0x1B8593A0 может быть неверным)
2. **Неправильная полярность модуляции** временной метки
3. **Неправильный порядок передачи битов**

Все остальные компоненты системы (частоты FDMA, временная структура, навигационное сообщение) реализованы корректно.

## 9. План действий

1. **Немедленно**: Проверить значение 0x1B8593A0 в официальной документации ICD ГЛОНАСС
2. **Эксперимент 1**: Инвертировать полярность временной метки
3. **Эксперимент 2**: Попробовать альтернативные значения временной метки
4. **Эксперимент 3**: Изменить порядок передачи битов
5. **Анализ**: Использовать SDR для записи и анализа сигнала

После каждого эксперимента необходимо проверить видимость сигналов приёмником.