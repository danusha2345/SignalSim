# Структура навигационного сообщения Galileo E5a F/NAV

## Обзор

Сигнал Galileo E5a передаёт сообщение F/NAV (Freely accessible NAVigation - свободно доступная навигация), предназначенное для одночастотных и двухчастотных пользователей. Оно обеспечивает более быстрое время до первого определения местоположения (TTFF) по сравнению с I/NAV.

## Характеристики сигнала

- **Частота**: 1176.45 МГц (E5a)
- **Модуляция**: BPSK(10) на информационной компоненте, BPSK(10) на пилотной компоненте
- **Скорость передачи чипов**: 10.23 Мчип/с
- **Скорость передачи данных**: 50 символов/с
- **Длительность символа**: 20 мс
- **Длительность страницы**: 10 секунд
- **Полное навигационное сообщение**: 600 секунд (60 страниц)

## Иерархия структуры сообщения

```
Полное навигационное сообщение (600 секунд)
├── 60 Страниц (10 секунд каждая)
    ├── Типы страниц 1-6: Различное содержимое
    ├── 5 Подкадров на страницу (2 секунды каждый)
        ├── 8 Слов на подкадр (250 мс каждое)
            ├── 10 Символов на слово (20 мс каждый)
```

## Структура кадра и компоновка сообщения

### Типы страниц и их содержимое

F/NAV использует 6 различных типов страниц, каждая из которых несёт определённую информацию:

#### Тип страницы 1 - Идентификатор спутника, часы и ионосферная коррекция

**Содержимое:**
- Время системы Galileo (GST)
- Параметры коррекции часов спутника
- SISA (точность сигнала в пространстве)
- Параметры ионосферной коррекции
- BGD (групповая задержка вещания)
- Состояние сигнала
- Статус валидности данных

**Детальная структура слов:**
- **Слово 1**: Тип (6 бит) + TOW (20 бит) + Резерв (2 бита)
- **Слово 2**: IODnav (10 бит) + t0c (14 бит) + af2 (6 бит)
- **Слово 3**: af1 (21 бит) + Резерв (8 бит) + E5a HS (2 бита)
- **Слово 4**: af0 (31 бит)
- **Слово 5**: ai0 (11 бит) + ai1 (11 бит) + ai2 (14 бит)
- **Слово 6**: Флаги регионов (5 бит) + BGD (10 бит) + E5a DVS (1 бит) + Резерв
- **Слова 7-8**: Зарезервировано + CRC

#### Тип страницы 2 - Эфемериды (1/3)

**Содержимое:**
- IODnav (версия навигационных данных)
- M0 (средняя аномалия на момент привязки)
- OMEGA_dot (скорость прецессии восходящего узла)
- e (эксцентриситет)
- Квадратный корень A (большая полуось)
- OMEGA0 (долгота восходящего узла)

**Детальные параметры:**
- **M0**: 32 бита, масштаб 2^-31 полуокружностей
- **e**: 32 бита, масштаб 2^-33 (безразмерная)
- **√A**: 32 бита, масштаб 2^-19 метров^1/2
- **OMEGA0**: 32 бита, масштаб 2^-31 полуокружностей
- **OMEGA_dot**: 24 бита, масштаб 2^-43 полуокружностей/сек

#### Тип страницы 3 - Эфемериды (2/3)

**Содержимое:**
- i0 (наклонение на момент привязки)
- omega (аргумент перигея)
- IDOT (скорость изменения наклонения)
- Delta_n (отклонение среднего движения)

**Детальные параметры:**
- **i0**: 32 бита, масштаб 2^-31 полуокружностей
- **omega**: 32 бита, масштаб 2^-31 полуокружностей
- **Delta_n**: 16 бит, масштаб 2^-43 полуокружностей/сек
- **IDOT**: 14 бит, масштаб 2^-43 полуокружностей/сек

#### Тип страницы 4 - Эфемериды (3/3) и коррекция часов

**Содержимое:**
- Cuc, Cus (коррекции аргумента широты)
- Crc, Crs (коррекции радиуса орбиты)
- Cic, Cis (коррекции наклонения)
- t0e (время привязки эфемерид)

**Детальные параметры:**
- **Cuc**: 16 бит, масштаб 2^-29 радиан
- **Cus**: 16 бит, масштаб 2^-29 радиан
- **Crc**: 16 бит, масштаб 2^-5 метров
- **Crs**: 16 бит, масштаб 2^-5 метров
- **Cic**: 16 бит, масштаб 2^-29 радиан
- **Cis**: 16 бит, масштаб 2^-29 радиан
- **t0e**: 14 бит, масштаб 60 секунд

#### Тип страницы 5 - Альманах, время и состояние

**Содержимое:**
- Параметры преобразования GST-UTC
- Смещение времени GST-GPS
- Альманах для одного спутника
- WN (номер недели)
- TOW (время недели)

**Параметры альманаха на спутник:**
- **IODa**: 4 бита (версия данных альманаха)
- **WNa**: 2 бита (неделя привязки альманаха)
- **t0a**: 10 бит, масштаб 600 секунд
- **√A**: 16 бит, масштаб 2^-11 метров^1/2
- **e**: 11 бит, масштаб 2^-16
- **omega**: 16 бит, масштаб 2^-15 полуокружностей
- **Delta_i**: 11 бит, масштаб 2^-14 полуокружностей
- **OMEGA0**: 16 бит, масштаб 2^-15 полуокружностей
- **OMEGA_dot**: 11 бит, масштаб 2^-33 полуокружностей/сек
- **M0**: 16 бит, масштаб 2^-15 полуокружностей

#### Тип страницы 6 - Зарезервировано
В настоящее время зарезервировано для будущего использования.

## Параметры времени

### Параметры преобразования GST-UTC
- **A0**: 32 бита, смещение (секунды)
- **A1**: 24 бита, коэффициент дрейфа (секунды/секунда)
- **Tot**: 8 бит, время привязки (часы)
- **WNot**: 8 бит, номер недели привязки
- **Delta_tLS**: 8 бит, текущие високосные секунды
- **WN_LSF**: 8 бит, номер недели високосной секунды
- **DN**: 3 бита, день недели високосной секунды
- **Delta_tLSF**: 8 бит, будущие високосные секунды

### Смещение времени GST-GPS (GGTO)
- **A0G**: 16 бит, смещение времени GPS-Galileo
- **A1G**: 12 бит, дрейф смещения времени GPS-Galileo
- **t0G**: 8 бит, время привязки
- **WN0G**: 6 бит, неделя привязки

## Прямое исправление ошибок (FEC)

F/NAV использует продвинутое FEC:
- **Свёрточное кодирование**: Скорость 1/2, длина кодового ограничения 7
- **Блочное перемежение**: Применяется по всей странице
- **CRC-24**: Циклический избыточный код для каждой страницы

### Полином CRC-24
```
G(x) = x^24 + x^23 + x^22 + x^21 + x^20 + x^19 + x^18 + x^17 + x^14 + x^13 + x^11 + x^10 + x^9 + x^8 + x^6 + x^3 + x + 1
```

## Расписание вещания

Страницы передаются в определённой последовательности:
1. Типы страниц 1-4 передаются каждые 50 секунд
2. Тип страницы 5 передаётся для разных спутников по очереди
3. Номинальное расписание обеспечивает доступность всех критических данных в течение 100 секунд

### Типичный шаблон передачи
```
Время (с) | 0-10  | 10-20 | 20-30 | 30-40 | 40-50 | 50-60 | ...
Тип стр.  |   1   |   2   |   3   |   4   | 5(SV1)|   1   | ...
```

## Процесс компоновки сообщения

### Формирование страницы
1. **Упаковка данных**: Навигационные параметры упаковываются в биты согласно типу страницы
2. **Добавление заголовка**: Добавляется тип страницы и время TOW
3. **Свёрточное кодирование**: Применяется кодирование со скоростью 1/2
4. **Перемежение**: Биты перемежаются по всей странице
5. **Добавление CRC**: Вычисляется и добавляется 24-битный CRC

### Структура слова
Каждое слово состоит из:
- 240 информационных бит (до кодирования)
- После кодирования: 488 бит
- Передаётся как 10 символов по 20 мс каждый

## Особенности реализации

### Процесс декодирования
1. **Синхронизация символов**: Обнаружение 20-мс символов
2. **Синхронизация страниц**: Определение границ страниц (10 с)
3. **Деперемежение**: Обратное блочное перемежение
4. **Декодирование Витерби**: Декодирование свёрточного кода
5. **Проверка CRC**: Проверка целостности страницы
6. **Извлечение параметров**: Извлечение и масштабирование навигационных данных

### Ключевые отличия от I/NAV
1. **Более быстрое TTFF**: Полные эфемериды за 50 секунд против 30 секунд
2. **Другое FEC**: Свёрточное кодирование против турбо-кодирования
3. **Структура страниц**: Фиксированные 10-секундные страницы против 2-секундных
4. **Распределение альманаха**: Более эффективное вещание альманаха

### Масштабные коэффициенты и единицы

Общие используемые масштабные коэффициенты:
- Угловые измерения: 2^-31 полуокружностей = π/2^31 радиан
- Время: Различные масштабы (60с, 600с, 604800с)
- Расстояние: метры с различными степенями 2
- Скорость: метры/секунда или полуокружности/секунда

### Возраст данных и валидность

- **IODnav**: Связывает наборы данных часов и эфемерид
- **Возраст данных**: Может быть вычислен из TOW и времён привязки
- **Период валидности**: Обычно 4 часа для эфемерид

## Обработка ошибок

Рекомендуемые процедуры обработки ошибок:
1. Ошибка CRC: Отбросить всю страницу
2. Проверка диапазонов: Валидация параметров по ожидаемым диапазонам
3. Проверка согласованности: Проверка соответствия IODnav между страницами
4. Проверка времени: Убедиться, что данные не устарели
5. Проверка состояния: Проверить, что спутник помечен как исправный